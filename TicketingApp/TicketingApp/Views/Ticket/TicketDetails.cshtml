@model TicketingApp.Models.Ticket
@{
    ViewData["Title"] = "TicketDetails";
}

<h1>TicketDetails</h1>
<hr />
<div class="row">
    <div class="col-12">
        <form asp-action="EditTicket" method="post" enctype="multipart/form-data">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            <div class="d-flex justify-content-between mb-2">
                <div class="col-md-3">
                    <label class="form-label">Created Date</label>
                    <input class="form-control text-dark" value="@Model.CreatedDateTime.ToString("yyyy-MM-dd hh:mm tt")" disabled>
                </div>
                @{
                    string tktAssignTo = "";
                    string tktAssignBy = "";
                    string tktCreatedBy = "";
                    if (Model.AssignedTo != null)
                    {
                        tktCreatedBy = string.Concat(Model.CreatedBy.FirstName, " ", Model.CreatedBy.LastName);
                    }

                    if(Model.AssignedTo != null)
                    {
                        tktAssignTo = string.Concat(Model.AssignedTo.FirstName, " ", Model.AssignedTo.LastName);
                    }
                    if (Model.AssignedBy != null)
                    {
                        tktAssignBy = string.Concat(Model.AssignedBy.FirstName, " ", Model.AssignedBy.LastName);
                    }
                }
                <div class="col-md-4">
                    <label class="form-label">Created By</label>
                    <input class="form-control text-dark" value="@tktCreatedBy" disabled>
                </div>
                <div class="col-md-4">
                    <label class="form-label">Location</label>
                    <input class="form-control text-dark" value="@Model.Location.Location" disabled>
                </div>
            </div>
            <div class="d-flex justify-content-between mb-2">
                <div class="col-md-3">
                    <label class="form-label">Service</label>
                    <input class="form-control text-dark" value="@Model.Category.Category" disabled>
                </div>
                <div class="col-md-4">
                    <label class="form-label">Category</label>
                    <input class="form-control text-dark" value="@Model.Category.SubCategory" disabled>
                </div>
                <div class="col-md-4">
                    <label class="form-label">Priority</label>
                    <input class="form-control text-dark" value="@Model.Priority.TktPriority" disabled>
                </div>
            </div>
            <div class="form-group mb-4">
                <label class="control-label">Title</label>
                <input asp-for="Title" class="form-control text-dark" disabled/>
            </div>

            <div class="form-group mb-2">
                <label asp-for="Description" class="control-label"></label>
                <textarea asp-for="Description" class="form-control text-dark" style="height:100px" disabled></textarea>
                <span asp-validation-for="Description" class="text-danger"></span>
            </div>
            <div class="my-3">
                <label class="form-label">Attachement</label>
                <input asp-for="TicketAttachement" class="form-control" />
            </div>

            @*Hidden fields*@
            <input type="hidden" asp-for="CategoryId" value="@Model.CategoryId" />
            <input type="hidden" asp-for="LocationId" value="@Model.LocationId" />
            <input type="hidden" asp-for="PriorityId" value="@Model.PriorityId" />
            <input type="hidden" asp-for="StatusId" value="@Model.StatusId" />
            <input type="hidden" asp-for="Status" value="@Model.Status" />
            <input type="hidden" asp-for="Location" value="@Model.Location" />
            <input type="hidden" asp-for="Category" value="@Model.Category" />
            <input type="hidden" asp-for="AssignedBy" value="@Model.AssignedBy" />
            <input type="hidden" asp-for="AssignedTo" value="@Model.AssignedTo" />
            <input type="hidden" asp-for="ClosedBy" value="@Model.ClosedBy" />
            <input type="hidden" asp-for="CreatedBy" value="@Model.CreatedBy" />
            <input type="hidden" asp-for="CreatedDateTime" value="@Model.CreatedDateTime" />
            <input type="hidden" asp-for="AssignedDateTime" value="@Model.AssignedDateTime" />
            <input type="hidden" asp-for="ResolvedDateTime" value="@Model.ResolvedDateTime" />
            <input type="hidden" asp-for="ClosedDateTime" value="@Model.ClosedDateTime" />

            @{
                int condition = 2;
                int subCond = 1;
            }

            <div class="form-group mt-4">
                
                @*1. If user and task not assigned - can be modified*@
                @if(condition==1 && subCond == 1)
                {
                    <input type="submit" value="Modify" class="btn btn-primary mr-2" style="width:7rem" name="submitButton" />
                }               
                               
                @*2. if Admin and not assigned - can assign*@
                @if (condition == 2 && subCond == 1)
                {
                    <input type="submit" value="Assign" class="btn btn-primary mr-2" style="width:7rem" name="submitButton" />
                }
                @*3. if Admin - unresolved then can reassign to next agent or close it*@               
                @if (condition == 3 && subCond == 1)
                {
                    <input type="submit" value="Reassign" class="btn btn-primary mr-2" style="width:7rem" name="submitButton" />
                } 
                @*4. if Agent - this task is assign to him and can resolve*@
                @if (condition == 4 && subCond == 1)
                {
                    <input type="submit" value="Resolve" class="btn btn-primary mr-2" style="width:7rem" name="submitButton" />
                }
               
                @*5. if Agent  -this task is assign to him and can declear un resolved able *@
                @if (condition == 5 && subCond == 1)
                {
                    <input type="submit" value="Can't Resolve" class="btn btn-primary mr-2" style="width:7rem" name="submitButton" />
                }             
                
                @*6. if Admin - resolved then can close*@
                @if (condition == 6 && subCond == 1)
                {
                    <input type="submit" value="Close" class="btn btn-primary mr-2" style="width:7rem" name="submitButton" />
                }
                <a asp-action="" class="btn btn-secondary mr-2" style="width:7rem">Back</a>
                <a asp-action="Index" class="btn btn-success mr-2" style="width:7rem">Home</a>                
            </div>
        </form>
    </div>
</div>
<partial name="_ValidationScriptsPartial" />
@*
@section Scripts {
    <script>
        function showComponent() {
            var hiddenComponent = document.getElementById('hiddenTA');
            hiddenComponent.style.display = 'block';
        }
    </script>
}
<button id="showButton" onclick="showComponent()">Show Hidden Component</button>
*@


